---
layout: post
author: Joel Clement
---

Malware Analysis is one of my favourite cybersecurity topics and I've always been super interested in it so all the way back in 2016 I decided to buy a book called "Practical Malware Analysis: The Hands-On Guide to Dissecting Malicious Software".. Looked through it for a bit and then I got busy and it ended up sitting on the shelf for a years - I'm sure everyone has a similar story. But having recently finished uni, I've had a lot of spare time between looking for a job. I figured this is the perfect chance to pick up that book again and finally go through it and improve my malware analysis skills a bit.

Since 2016 I've come a long way with all of my cybersecurity skills and knowledge and as part of that I gained some malware analysis experience from other sources - btw shoutout to [hasherezade](https://twitter.com/hasherezade) for being an inspiration in the community and for providing so much great advise when I DM'd her asking where to start (although I'm sure she doesn't really need the shoutout) - but I think chapter one is still a good place to start as it will serve as a good refresh for me and who knows maybe I'll still learn some small tips.

Okay, now with all of that said, lets get on with the chapter one lab. This lab is split into four parts each with 4-7 questions to answer aiming to help teach some basic malware analysis techniques so should hopefully be fairly easy.

# Lab 1-1

![1-1 Questions](https://i.imgur.com/UDrhydD.png)

# Q1
Okay so question one is very simple all I need to do is upload some files to VirusTotal and see it comes up as malware. My malware analysis environment doesn't have network access so I'm going to take a slightly different approach and get the file hashes and put them into virustotal on a device that does have network access. So to do this I'll use a program called pestudio.

![pestudio](https://i.imgur.com/qjMrTuZ.png)

So we can see that the md5 signature for the dll file is "290934C61DE9176AD682FFDD65F0A669" and "BB7425b82141A1C0F7D60E5106676BB1" for the exe. When we put these into virustotal we can see that they are known viruses - there's a lot more we can do with this but this is all the question wants so for now we'll leave it at that. 

![l1-1vt](https://i.imgur.com/4b5HbTb.png)

# Q2
Okay now that we know this lets go back to pestudio to answer question two - we can look at the compiler-stamp line to see that both files were compiled 19th December 2010 at 4:16pm.

# Q3
Question three asks if there is any indication that the files are packed. So to check if they are packed we'll look at peid where we can see that neither of the files are packed.

![notpacked](https://i.imgur.com/RbxKqGF.png)

# Q4
Next we'll look at the fuctions tab in pestudio. We're looking for any functions that will tell us any actions that the malware can perform we can do a quick google for each of these functions if we don't know what they do. After googling to see what they do, the most interesting functions seem to be "FindNextFileA", "FindFirstFileA", "CreateFileA", "CopyFileA". This tells us that the malware can look for certain files and modify them as well as having the ability to copy and create new files. While Looking at the dll will tell us that it imports the function "CreateProcess" which means it can start other programs.

![functionsl1-1](https://i.imgur.com/j6RpOgn.png)

# Q5
Now we'll look at question five. "Are there any other files or host-based indicators you could look for on infected  files?" - Okay so without using dynamic analysis it can be hard to see what files the malware might be using or creating for sure but we can find some hints by looking at the strings. Usually you might run the strings command to do this but since I already have pestudio open I'll just look in the strings tab which has the added benefit of being able to sort by "hints" which can help us find files quicker. 

![stringsl1-1](https://i.imgur.com/QUMk6aQ.png)

The first thing I notice is "kerne132.dll" this is really weird... As it should be "kernel32.dll" so maybe the exe is creating a new dll called kerne132.dll and attempting to hide it while looking like the legitmate file. It's also possible that the malware is modifying kernel32.dll and then renaming it. The only other interesting file is "Lab01-01.dll" which is of course is the other file for this part of the lab. 

# Q6
Moving on to question 6, we're looking for network indicators now. Again, strings is really useful for this. We didn't see any when looking at the exe so how about we look at the dll file this time.

![strings2l1-1](https://i.imgur.com/zJ0VO1q.png)

The only network indicator we can find here is an ip address "127.26.152.13"

# Q7

The final question for this section of the lab is to guess the purpose of the malware. With so little information this can be hard but personally I might say that the exe is a malware dropper which is downloading the dll. As for the dll itself but it is likely some kind of backdoor allowing the attacker to open, create and modify files as well as opening any processes which could be used to run scripts or other malware.

# Lab 1-2
Moving on to the second section of the lab we'll be using the "Lab1-2.exe" file for these questions

![1-2 Questions](https://i.imgur.com/QeWfGGC.png)

# Q1

This question is again asking to look at VirusTotal for details on this file. We'll repeat the same process as we did for the previous files and find that it is again known malware. 

![l1-2VT](https://i.imgur.com/0OddDYK.png)

# Q2

Question two needs us to check if the file is packed so lets open it in peid.

![l1-2peid](https://i.imgur.com/BHbYTTa.png)

And we can see that it's packed with a common packer called UPX. Let's unpack this.

UPX is super easy to unpack as the tool used to packed and unpack these files is available for free and very easy to use.

```sh 
upx "C:\Users\MalAnalysis\Documents\Practical Malware Analysis Labs\BinaryCollection\Chapter_1L\Lab01-02.exe" -d -o "C:\Users\MalAnalysis\Documents\Practical Malware Analysis Labs\BinaryCollection\Chapter_1L\Lab1-2-Unpacked.exe" 
```
Using this command we can unpack the file to a new file called Lab1-2-Unpacked.exe. This is the file we'll be using for the rest of this lab section.

# Q3


# Q4

# Lab 1-3

![1-3 Questions](https://i.imgur.com/T8Ho0b5.png)

# Lab 1-4

![1-4 Questions](https://i.imgur.com/cvccsJ7.png)

